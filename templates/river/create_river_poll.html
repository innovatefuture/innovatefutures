{% load static %}
{#  Modal blurred background overlay  #}
<section id="river-poll"
         class="z-20 flex justify-center items-center flex-col h-full w-full fixed left-0 top-0 backdrop-blur">
    {#  White modal background  #}
    <div class="w-full sm:w-[360px]">
        <div class="bg-white p-2.5 m-2.5 sm:m-0">
            {#  Modal title  #}
            <h1 class="text-large text-black/75">
                {{prompt}}
            </h1>
            {% include "partials/vertical-spacer.html" with space="4.5" %}

            <!-- Determine whether to send the request to a general poll or a stage-based poll -->
            <form hx-post="{% if stage and topic %}{% url 'create_stage_poll' slug stage topic %}{% else %}{% url 'create_general_river_poll' slug %}{% endif %}"
                  hx-swap="none" class="m-x" id="poll-form-{{ stage|default:'general' }}-{{ topic|default:'general' }}">
                {% csrf_token %}

                <textarea class="block w-full h-2/3 px-3 py-1.5 rounded text-body" name="description">{{ default }}</textarea>

                {% include "partials/vertical-spacer.html" with space="6" %}
                <p class="text-meta">
                    Creating this poll will ask Swimmers if the above statement is acceptable.
                </p>

                {% include "partials/vertical-spacer.html" with space="6" %}
                <span class="block flex items-center gap-3">
                    <button onclick="event.preventDefault(); removePollModal();" class="button button-on-white">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 7H3.83L9.42 1.41L8 0L0 8L8 16L9.41 14.59L3.83 9H16V7Z" fill="#9759FF"/>
                        </svg>
                    </button>
                    <input type="submit" value="Create poll" class="button button-important" onclick="submitAndRemovePollModal()">
                </span>
            </form>
        </div>
    </div>
</section>

<script>
    function submitAndRemovePollModal() {
        htmx.on('#poll-form-{{ stage|default:'general' }}-{{ topic|default:'general' }}', 'htmx:afterRequest', function(e){
            htmx.ajax('GET', '{% url 'view_river' slug %}', '#river-poll-section');
            removePollModal();
        })
        document.getElementById('poll-form-{{ stage|default:'general' }}-{{ topic|default:'general' }}').requestSubmit();
    }

    function removePollModal() {
        document.getElementById('river-poll').remove();
    }
</script>
